<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Did We Win?</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Anton&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,400&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --yes:  #4ade80;
      --no:   #f87171;
      --live: #fbbf24;
      --bg:   #111318;
      --surface: #1a1d24;
      --surface2: #22262f;
      --border: rgba(255,255,255,0.07);
      --text-dim: rgba(255,255,255,0.35);
    }

    body {
      min-height: 100vh;
      background: var(--bg);
      font-family: 'DM Sans', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2.5rem 1rem 2rem;
    }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    header { text-align: center; margin-bottom: 2.4rem; }

    h1 {
      font-family: 'Anton', sans-serif;
      font-size: clamp(2.8rem, 8vw, 5.5rem);
      color: #fff;
      letter-spacing: 0.03em;
      line-height: 1;
      text-transform: uppercase;
    }
    h1 em { color: var(--live); font-style: normal; }

    .subtitle {
      margin-top: 0.55rem;
      font-size: 0.7rem;
      color: #444;
      letter-spacing: 0.2em;
      text-transform: uppercase;
    }

    .refresh-info {
      margin-top: 0.3rem;
      font-size: 0.67rem;
      color: #353535;
      letter-spacing: 0.07em;
    }
    #last-updated { color: #4a4a4a; }

    #refresh-btn {
      background: none;
      border: 1px solid #2a2a2a;
      color: #4a4a4a;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.67rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      padding: 0.2rem 0.6rem;
      border-radius: 20px;
      cursor: pointer;
      margin-left: 0.5rem;
      transition: border-color 0.2s, color 0.2s;
      vertical-align: middle;
    }
    #refresh-btn:hover { border-color: #555; color: #888; }
    #refresh-btn.spinning { animation: spin 0.6s linear; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    /* ‚îÄ‚îÄ GRID ‚îÄ‚îÄ */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.4rem;
      width: 100%;
      max-width: 1080px;
    }

    /* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
    .empty-state {
      grid-column: 1 / -1;
      text-align: center;
      padding: 4rem 2rem;
      color: var(--text-dim);
    }
    .empty-state .empty-icon { font-size: 3rem; margin-bottom: 1rem; opacity: 0.4; }
    .empty-state p { font-size: 0.9rem; letter-spacing: 0.08em; }

    /* ‚îÄ‚îÄ CARD SHELL ‚îÄ‚îÄ */
    .card {
      border-radius: 18px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 8px 40px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.05);
      cursor: pointer;
      min-height: 360px;
      transition: box-shadow 0.25s, transform 0.25s;
    }
    .card:hover { transform: translateY(-2px); }

    .card-front,
    .card-back {
      position: absolute;
      inset: 0;
      padding: 1.5rem 1.6rem 1.4rem;
      display: flex;
      flex-direction: column;
      gap: 0.65rem;
      transition: opacity 0.28s ease, transform 0.28s ease;
      border-radius: 18px;
      overflow: hidden;
    }

    .card-back {
      opacity: 0;
      transform: translateY(10px);
      pointer-events: none;
    }

    @media (hover: hover) {
      .card:not(.flipped):hover .card-front {
        opacity: 0;
        transform: translateY(-10px);
        pointer-events: none;
      }
      .card:not(.flipped):hover .card-back {
        opacity: 1;
        transform: translateY(0);
        pointer-events: all;
      }
    }

    .card.flipped .card-front {
      opacity: 0;
      transform: translateY(-10px);
      pointer-events: none;
    }
    .card.flipped .card-back {
      opacity: 1;
      transform: translateY(0);
      pointer-events: all;
    }

    /* subtle texture */
    .card-front::before, .card-back::before {
      content: '';
      position: absolute;
      inset: 0;
      background: repeating-linear-gradient(
        -55deg,
        rgba(255,255,255,0.02) 0px, rgba(255,255,255,0.02) 1px,
        transparent 1px, transparent 22px
      );
      pointer-events: none;
      border-radius: inherit;
    }

    /* shimmer */
    .card.loading .card-front::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
      background-size: 200% 100%;
      animation: shimmer 1.4s infinite;
      border-radius: inherit;
    }
    @keyframes shimmer {
      0%   { background-position: -200% 0; }
      100% { background-position:  200% 0; }
    }

    /* ‚îÄ‚îÄ‚îÄ TEAM CARD THEMES ‚îÄ‚îÄ‚îÄ */
    /* Love teams ‚Äî refined gradients, softer glows */
    .card.team-love .card-front,
    .card.team-love .card-back {
      /* Applied dynamically via JS */
    }

    /* Hate team ‚Äî desaturated, ugly on purpose */
    .card.hate-card .card-front,
    .card.hate-card .card-back {
      background: linear-gradient(160deg, #1c1800 0%, #2a2100 45%, #141100 100%);
      filter: saturate(0.4) brightness(0.8);
    }
    .card.hate-card {
      box-shadow: 0 8px 40px rgba(0,0,0,0.9), 0 0 0 1px rgba(80,60,0,0.15);
      transform: rotate(-0.5deg);
    }
    .card.hate-card:hover { transform: rotate(-0.5deg) translateY(-2px); }
    .card.hate-card .team-name {
      color: #6a6040;
      text-decoration: line-through;
      text-decoration-color: rgba(255,80,80,0.4);
    }
    .card.hate-card .card-front::after {
      content: 'ü§Æ ü§¢ ü§Æ';
      position: absolute;
      bottom: 0.5rem;
      right: 0.6rem;
      font-size: 2rem;
      opacity: 0.18;
      pointer-events: none;
    }
    .card.hate-card .answer.yes { color: #7a9966; text-shadow: none; }
    .card.hate-card .answer.yes::after { content: ' ü§¢ ugh'; font-size: 0.35em; color: rgba(255,255,255,0.25); vertical-align: middle; }
    .card.hate-card .answer.no::after  { content: ' üòÇüéâ'; font-size: 0.5em; vertical-align: middle; }
    .card.hate-card .hint { color: rgba(255,255,255,0.08); }

    /* ‚îÄ‚îÄ TEAM HEADER ‚îÄ‚îÄ */
    .team-header {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .team-emoji {
      font-size: 1.3rem;
      line-height: 1;
      display: block;
      margin-bottom: 0.22rem;
    }

    .team-name-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: nowrap;
      line-height: 1;
    }
    .team-tag-row {
      display: flex;
      align-items: center;
      margin-top: 0.28rem;
    }

    .team-name {
      font-family: 'Anton', sans-serif;
      font-size: clamp(1rem, 3.2vw, 1.4rem);
      letter-spacing: 0.06em;
      text-transform: uppercase;
      line-height: 1;
      white-space: nowrap;
      color: #fff;
    }

    .team-sub {
      font-size: 0.64rem;
      letter-spacing: 0.13em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.35);
      margin-top: 0.25rem;
    }

    .love-tag, .hate-tag {
      font-size: 0.58rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      padding: 0.16rem 0.5rem;
      border-radius: 20px;
      font-weight: 500;
      white-space: nowrap;
    }
    .love-tag { background: rgba(255,255,255,0.12); color: rgba(255,255,255,0.6); }
    .hate-tag { background: rgba(255,50,50,0.12); color: rgba(255,120,120,0.6); }

    /* ‚îÄ‚îÄ FRONT GAME DETAILS ‚îÄ‚îÄ */
    .front-game {
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }
    .front-game-label {
      font-size: 0.58rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.25);
      font-weight: 500;
    }
    .front-game-line {
      font-size: 0.8rem;
      color: rgba(255,255,255,0.65);
      line-height: 1.4;
    }
    .front-game-line strong { color: rgba(255,255,255,0.9); }

    .front-badge {
      display: inline-block;
      font-family: 'Anton', sans-serif;
      font-size: 0.68rem;
      letter-spacing: 0.04em;
      padding: 0.08rem 0.35rem;
      border-radius: 4px;
      margin-left: 0.3rem;
      vertical-align: middle;
      position: relative; top: -1px;
    }
    .front-badge.w    { background: rgba(74,222,128,0.15); color: var(--yes); }
    .front-badge.l    { background: rgba(248,113,113,0.15); color: var(--no); }
    .front-badge.live { background: rgba(251,191,36,0.15); color: var(--live); }
    .front-badge.up   { background: rgba(255,255,255,0.07); color: rgba(255,255,255,0.38); font-family: 'DM Sans', sans-serif; font-size: 0.68rem; }

    .answer {
      font-family: 'Anton', sans-serif;
      font-size: clamp(3.2rem, 9vw, 5rem);
      line-height: 1;
      letter-spacing: -0.01em;
    }
    .answer.yes  { color: var(--yes);  text-shadow: 0 0 30px rgba(74,222,128,0.35); }
    .answer.no   { color: var(--no);   text-shadow: 0 0 30px rgba(248,113,113,0.35); }
    .answer.live { color: var(--live); text-shadow: 0 0 30px rgba(251,191,36,0.4); animation: blink 1.2s ease-in-out infinite; }
    .answer.tbd  { color: #333; font-size: clamp(2rem, 5vw, 3rem); }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50%       { opacity: 0.35; }
    }

    .live-details {
      font-family: 'Anton', sans-serif;
      font-size: 0.95rem;
      letter-spacing: 0.06em;
      color: rgba(251,191,36,0.75);
      margin-top: -0.5rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      flex-wrap: wrap;
    }

    .live-opponent {
      font-size: 0.78rem;
      color: rgba(255,255,255,0.5);
      letter-spacing: 0.05em;
      margin-top: -0.25rem;
    }
    .live-opponent strong { color: rgba(255,255,255,0.8); }

    .winning-tag {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.62rem;
      font-weight: 600;
      letter-spacing: 0.07em;
      text-transform: uppercase;
      padding: 0.09rem 0.38rem;
      border-radius: 4px;
    }
    .winning-tag         { background: rgba(74,222,128,0.14); color: var(--yes); }
    .winning-tag.losing  { background: rgba(248,113,113,0.14); color: var(--no); }
    .winning-tag.tied    { background: rgba(255,255,255,0.08); color: rgba(255,255,255,0.45); }

    /* hint */
    .hint {
      font-size: 0.6rem;
      color: rgba(255,255,255,0.15);
      letter-spacing: 0.12em;
      text-transform: uppercase;
      margin-top: auto;
      text-align: right;
    }
    .hint-hover { display: inline; }
    .hint-tap   { display: none; }
    @media (hover: none) {
      .hint-hover { display: none; }
      .hint-tap   { display: inline; }
    }

    /* ‚îÄ‚îÄ STATS ROW ‚îÄ‚îÄ */
    .stats-row {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 0.3rem;
      margin-top: -0.15rem;
    }

    .rank-badge {
      font-family: 'Anton', sans-serif;
      font-size: 0.75rem;
      letter-spacing: 0.06em;
      background: rgba(251,191,36,0.16);
      color: var(--live);
      padding: 0.15rem 0.5rem;
      border-radius: 5px;
      border: 1px solid rgba(251,191,36,0.22);
    }

    .rec-item {
      font-size: 0.67rem;
      color: rgba(255,255,255,0.5);
      letter-spacing: 0.05em;
      background: rgba(255,255,255,0.07);
      padding: 0.15rem 0.45rem;
      border-radius: 5px;
    }
    .rec-item.conf { color: rgba(255,255,255,0.35); background: rgba(255,255,255,0.04); }

    .opp-rank {
      font-family: 'Anton', sans-serif;
      font-size: 0.7rem;
      color: rgba(251,191,36,0.7);
      letter-spacing: 0.04em;
    }

    /* ‚îÄ‚îÄ BACK ‚îÄ‚îÄ */
    .back-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 0.1rem;
    }

    .back-title {
      font-family: 'Anton', sans-serif;
      font-size: 0.95rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.45);
    }

    .back-meta {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      flex-wrap: wrap;
    }

    .back-rank {
      font-family: 'Anton', sans-serif;
      font-size: 0.72rem;
      letter-spacing: 0.06em;
      background: rgba(251,191,36,0.16);
      color: var(--live);
      padding: 0.1rem 0.38rem;
      border-radius: 4px;
      border: 1px solid rgba(251,191,36,0.22);
    }

    .back-rec {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.4);
      background: rgba(255,255,255,0.06);
      padding: 0.1rem 0.38rem;
      border-radius: 4px;
    }
    .back-rec.conf { color: rgba(255,255,255,0.28); }

    .schedule-list {
      display: flex;
      flex-direction: column;
      gap: 0.42rem;
      overflow-y: auto;
      flex: 1;
    }

    .sched-row {
      display: flex;
      align-items: center;
      gap: 0.55rem;
      padding: 0.45rem 0.55rem;
      border-radius: 8px;
      background: rgba(0,0,0,0.18);
      font-size: 0.8rem;
      color: rgba(255,255,255,0.85);
    }
    .sched-row.current {
      background: rgba(255,255,255,0.09);
      outline: 1px solid rgba(255,255,255,0.13);
    }

    .sched-date {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.3);
      min-width: 52px;
      letter-spacing: 0.04em;
    }

    .sched-opp {
      flex: 1;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .sched-result {
      font-family: 'Anton', sans-serif;
      font-size: 0.72rem;
      letter-spacing: 0.05em;
      padding: 0.08rem 0.38rem;
      border-radius: 4px;
      white-space: nowrap;
    }
    .sched-result.w    { background: rgba(74,222,128,0.14); color: var(--yes); }
    .sched-result.l    { background: rgba(248,113,113,0.14); color: var(--no); }
    .sched-result.live { background: rgba(251,191,36,0.14); color: var(--live); animation: blink 1.2s ease-in-out infinite; }
    .sched-result.upcoming { background: rgba(255,255,255,0.06); color: rgba(255,255,255,0.35); font-family: 'DM Sans', sans-serif; font-size: 0.67rem; }

    .sched-opp-rank {
      font-family: 'Anton', sans-serif;
      font-size: 0.68rem;
      color: rgba(251,191,36,0.65);
    }

    .divider { height: 1px; background: rgba(255,255,255,0.08); margin: 0.2rem 0; }

    .schedule-list::-webkit-scrollbar { width: 3px; }
    .schedule-list::-webkit-scrollbar-track { background: transparent; }
    .schedule-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.12); border-radius: 2px; }

    footer {
      margin-top: 2rem;
      font-size: 0.62rem;
      color: #252525;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      text-align: center;
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       TEAM SELECTOR PANEL
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .selector-wrapper {
      width: 100%;
      max-width: 1080px;
      margin-top: 2.5rem;
    }

    .selector-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .selector-title {
      font-family: 'Anton', sans-serif;
      font-size: 0.95rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.3);
    }

    .selector-count {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.2);
      letter-spacing: 0.1em;
    }

    .clear-all-btn {
      font-size: 0.65rem;
      font-family: inherit;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.35);
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 6px;
      padding: 0.2rem 0.55rem;
      cursor: pointer;
      transition: all 0.15s;
    }
    .clear-all-btn:hover {
      color: rgba(255,80,80,0.9);
      background: rgba(255,60,60,0.12);
      border-color: rgba(255,60,60,0.25);
    }

    /* Search */
    .selector-search-wrap {
      position: relative;
      margin-bottom: 0.75rem;
    }
    .selector-search {
      width: 100%;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: rgba(255,255,255,0.75);
      font-family: 'DM Sans', sans-serif;
      font-size: 0.85rem;
      padding: 0.6rem 1rem 0.6rem 2.4rem;
      outline: none;
      transition: border-color 0.2s;
    }
    .selector-search::placeholder { color: rgba(255,255,255,0.2); }
    .selector-search:focus { border-color: rgba(255,255,255,0.18); }
    .search-icon {
      position: absolute;
      left: 0.8rem;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(255,255,255,0.2);
      font-size: 0.85rem;
      pointer-events: none;
    }

    /* Team list */
    .team-browser {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(210px, 1fr));
      gap: 0.5rem;
      max-height: 260px;
      overflow-y: auto;
      padding: 0.1rem;
    }
    .team-browser::-webkit-scrollbar { width: 4px; }
    .team-browser::-webkit-scrollbar-track { background: transparent; }
    .team-browser::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 2px; }

    .team-option {
      display: flex;
      align-items: center;
      gap: 0.55rem;
      padding: 0.55rem 0.75rem;
      border-radius: 9px;
      background: var(--surface);
      border: 1px solid transparent;
      cursor: pointer;
      transition: background 0.15s, border-color 0.15s, opacity 0.15s;
      user-select: none;
    }
    .team-option:hover { background: var(--surface2); border-color: rgba(255,255,255,0.08); }
    .team-option.selected {
      background: rgba(255,255,255,0.06);
      border-color: rgba(255,255,255,0.15);
    }
    .team-option.disabled { opacity: 0.28; pointer-events: none; }
    .team-option.hate-option {
      background: rgba(40,20,20,0.7);
      border-color: rgba(255,50,50,0.08);
    }
    .team-option.hate-option.selected { border-color: rgba(255,50,50,0.2); }

    .option-check {
      width: 16px;
      height: 16px;
      border-radius: 4px;
      border: 1.5px solid rgba(255,255,255,0.18);
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.65rem;
      transition: background 0.15s, border-color 0.15s;
    }
    .team-option.selected .option-check {
      background: rgba(255,255,255,0.15);
      border-color: rgba(255,255,255,0.3);
    }
    .option-emoji { font-size: 1rem; flex-shrink: 0; }
    .option-info { min-width: 0; }
    .option-name {
      font-size: 0.8rem;
      font-weight: 500;
      color: rgba(255,255,255,0.8);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .option-conf {
      font-size: 0.62rem;
      color: rgba(255,255,255,0.28);
      letter-spacing: 0.04em;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Celebrity Packs */
    .celeb-section {
      margin-bottom: 1rem;
    }
    .celeb-row {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .celeb-chip {
      display: flex;
      align-items: center;
      gap: 0.45rem;
      padding: 0.35rem 0.75rem 0.35rem 0.5rem;
      border-radius: 20px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      cursor: pointer;
      font-size: 0.78rem;
      color: rgba(255,255,255,0.6);
      transition: all 0.15s;
      user-select: none;
    }
    .celeb-chip:hover {
      background: rgba(255,255,255,0.1);
      border-color: rgba(255,255,255,0.25);
      color: rgba(255,255,255,0.9);
      transform: translateY(-1px);
    }
    .celeb-chip:active { transform: translateY(0); }
    .celeb-avatar { font-size: 1.1rem; line-height: 1; }
    .celeb-name { font-weight: 500; letter-spacing: 0.02em; }

    /* Selected team chips (drag to reorder) */
    .selected-section {
      margin-bottom: 1rem;
    }
    .selected-label {
      font-size: 0.62rem;
      color: rgba(255,255,255,0.2);
      letter-spacing: 0.15em;
      text-transform: uppercase;
      margin-bottom: 0.5rem;
    }
    .selected-chips {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      min-height: 44px;
      align-items: flex-start;
    }
    .chip {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.38rem 0.6rem 0.38rem 0.5rem;
      border-radius: 8px;
      background: var(--surface2);
      border: 1px solid rgba(255,255,255,0.1);
      cursor: grab;
      user-select: none;
      transition: background 0.15s, border-color 0.15s, box-shadow 0.15s;
      font-size: 0.78rem;
      color: rgba(255,255,255,0.75);
    }
    .chip:hover { background: #2c3040; border-color: rgba(255,255,255,0.18); }
    .chip.dragging {
      opacity: 0.4;
      cursor: grabbing;
    }
    .chip.drag-over {
      box-shadow: 2px 0 0 0 rgba(255,255,255,0.3);
    }
    .chip-emoji { font-size: 0.95rem; }
    .chip-name { font-size: 0.75rem; font-weight: 500; white-space: nowrap; }
    .chip-remove {
      margin-left: 0.1rem;
      width: 16px;
      height: 16px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 0.7rem;
      color: rgba(255,255,255,0.3);
      transition: color 0.15s, background 0.15s;
    }
    .chip-remove:hover { color: var(--no); background: rgba(248,113,113,0.12); }
    .chip-drag-handle {
      color: rgba(255,255,255,0.18);
      font-size: 0.7rem;
      cursor: grab;
    }

    .no-results {
      grid-column: 1 / -1;
      text-align: center;
      padding: 2rem 1rem;
      color: rgba(255,255,255,0.2);
      font-size: 0.8rem;
    }

    /* Separator */
    .panel-sep {
      border: none;
      border-top: 1px solid rgba(255,255,255,0.05);
      margin: 2rem 0;
      width: 100%;
      max-width: 1080px;
    }
    /* Category pills */
    .category-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin-bottom: 0.75rem;
    }
    .cat-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.3rem 0.75rem;
      border-radius: 20px;
      background: var(--surface);
      border: 1px solid rgba(255,255,255,0.08);
      color: rgba(255,255,255,0.5);
      font-size: 0.72rem;
      font-weight: 500;
      letter-spacing: 0.04em;
      cursor: pointer;
      transition: background 0.15s, border-color 0.15s, color 0.15s;
      user-select: none;
    }
    .cat-pill:hover { background: var(--surface2); color: rgba(255,255,255,0.8); border-color: rgba(255,255,255,0.15); }
    .cat-pill.active {
      background: rgba(255,255,255,0.12);
      border-color: rgba(255,255,255,0.28);
      color: #fff;
    }
    .cat-clear {
      display: inline-flex;
      align-items: center;
      padding: 0.3rem 0.65rem;
      border-radius: 20px;
      background: rgba(248,113,113,0.1);
      border: 1px solid rgba(248,113,113,0.2);
      color: rgba(248,113,113,0.7);
      font-size: 0.68rem;
      cursor: pointer;
      transition: background 0.15s, color 0.15s;
      letter-spacing: 0.04em;
    }
    .cat-clear:hover { background: rgba(248,113,113,0.18); color: var(--no); }
    .cat-active-label {
      font-size: 0.67rem;
      color: rgba(255,255,255,0.3);
      letter-spacing: 0.1em;
      margin-bottom: 0.4rem;
      display: none;
    }
    .cat-active-label.visible { display: block; }

  </style>
</head>
<body>

<header>
  <h1>Did We <em>Win?</em></h1>
  <p class="subtitle">Men's Basketball ¬∑ Live Scores</p>
  <p class="refresh-info">Auto-refreshes every 60s ¬∑ updated: <span id="last-updated">‚Äî</span><button id="refresh-btn" onclick="manualRefresh()">‚Üª now</button></p>
</header>

<div class="grid" id="grid">
  <div class="empty-state">
    <div class="empty-icon">üèÄ</div>
    <p>Select your favorite teams below to get started</p>
  </div>
</div>

<hr class="panel-sep">

<div class="selector-wrapper">
  <div class="selector-header">
    <span class="selector-title">Your Teams</span>
    <span class="selector-count" id="sel-count">0 / 6 selected ¬∑ drag chips to reorder</span>
    <button class="clear-all-btn" id="clear-all-btn" onclick="clearAllTeams()" style="display:none">Clear all</button>
  </div>

  <!-- Selected chips -->
  <div class="selected-section">
    <div class="selected-label">Selected (drag to reorder)</div>
    <div class="selected-chips" id="selected-chips"></div>
  </div>

  <!-- Celebrity Packs -->
  <div class="celeb-section">
    <div class="selected-label">Load a celebrity's picks</div>
    <div class="celeb-row" id="celeb-row"></div>
  </div>

  <!-- Category pills -->
  <div class="category-row" id="category-row"></div>
  <div class="cat-active-label" id="cat-active-label"></div>

  <!-- Search + browser -->
  <div class="selector-search-wrap">
    <span class="search-icon">üîç</span>
    <input class="selector-search" id="team-search" type="text" placeholder="Search teams‚Ä¶" autocomplete="off" />
  </div>
  <div class="team-browser" id="team-browser"></div>
</div>

<footer>Data via ESPN ¬∑ hover or tap a card to see the full schedule</footer>

<script>
// ‚îÄ‚îÄ‚îÄ TEAM METADATA OVERLAY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// IDs come entirely from ESPN's API at boot ‚Äî we NEVER hardcode them.
// This map provides display overrides, emojis, vibes, and search aliases,
// keyed by ESPN's canonical "location" string (what ESPN uses as the school name).
//
// 'Duke' ‚Üí display:'Dook' means: ESPN tells us the team is "Duke" (id=150),
// and we override the display name in our UI to "Dook".

const TEAM_META = {
  // ‚îÄ‚îÄ ACC ‚îÄ‚îÄ
  'Boston College':   { emoji: 'ü¶Ö' },
  'California':       { display: 'Cal',          short: 'Cal',        emoji: 'üêª' },
  'Clemson':          { emoji: 'üêÖ' },
  'Duke':             { display: 'Dook',          short: 'Dook',       emoji: 'ü§Æ', vibe: 'hate', aliases: ['duke','d00k','dook'] },
  'Florida State':    { emoji: 'üèπ' },
  'Georgia Tech':     { emoji: 'üêù' },
  'Louisville':       { emoji: 'üÉè' },
  'Miami':            { emoji: 'üåä' },
  'North Carolina':   { emoji: 'üíô' },
  'NC State':         { emoji: 'üê∫' },
  'Notre Dame':       { emoji: '‚òòÔ∏è' },
  'Pittsburgh':       { short: 'Pitt',            emoji: 'üêæ' },
  'SMU':              { emoji: 'üê¥' },
  'Stanford':         { emoji: 'üå≤' },
  'Syracuse':         { emoji: 'üçä' },
  'Virginia':         { emoji: 'üü†' },
  'Virginia Tech':    { emoji: 'ü¶É' },
  'Wake Forest':      { emoji: 'üòà' },

  // ‚îÄ‚îÄ Big Ten ‚îÄ‚îÄ
  'Illinois':         { emoji: 'ü¶£' },
  'Indiana':          { emoji: '‚õ∞Ô∏è' },
  'Iowa':             { emoji: 'üêª' },
  'Maryland':         { emoji: 'üê¢' },
  'Michigan':         { emoji: '„ÄΩÔ∏è' },
  'Michigan State':   { emoji: 'üíö' },
  'Minnesota':        { emoji: 'üêøÔ∏è' },
  'Nebraska':         { emoji: 'üåΩ' },
  'Northwestern':     { emoji: 'üê±' },
  'Ohio State':       { emoji: 'üå∞' },
  'Oregon':           { emoji: 'ü¶Ü' },
  'Penn State':       { emoji: 'ü¶Å' },
  'Purdue':           { emoji: 'üöÇ' },
  'Rutgers':          { emoji: 'ü¶ï' },
  'UCLA':             { emoji: 'üêª' },
  'USC':              { emoji: '‚úåÔ∏è' },
  'Washington':       { emoji: 'üêï' },
  'Wisconsin':        { emoji: 'ü¶°' },

  // ‚îÄ‚îÄ Big 12 ‚îÄ‚îÄ
  'Arizona':          { emoji: 'üêª' },
  'Arizona State':    { emoji: 'üòà' },
  'Baylor':           { emoji: 'üêª' },
  'BYU':              { emoji: 'ü¶Å' },
  'Cincinnati':       { emoji: 'üêª' },
  'Colorado':         { emoji: 'ü¶¨' },
  'Houston':          { emoji: 'üêæ' },
  'Iowa State':       { emoji: 'üå™Ô∏è' },
  'Kansas':           { emoji: 'üê¶' },
  'Kansas State':     { short: 'K-State',         emoji: 'üêæ' },
  'Oklahoma State':   { short: 'Okla State',       emoji: 'ü§†' },
  'TCU':              { emoji: 'üê∏' },
  'Texas':            { emoji: 'ü§ò' },
  'Texas Tech':       { emoji: 'üî¥' },
  'UCF':              { emoji: '‚öîÔ∏è' },
  'Utah':             { emoji: 'ü¶Ö' },
  'West Virginia':    { emoji: '‚õ∞Ô∏è' },

  // ‚îÄ‚îÄ SEC ‚îÄ‚îÄ
  'Alabama':          { emoji: 'üêò' },
  'Arkansas':         { emoji: 'üêó' },
  'Auburn':           { emoji: 'üêØ' },
  'Florida':          { emoji: 'üêä' },
  'Georgia':          { emoji: 'üêæ' },
  'Kentucky':         { emoji: 'üê±' },
  'LSU':              { emoji: 'üêØ' },
  'Mississippi':      { display: 'Ole Miss',       short: 'Ole Miss',   emoji: 'üêª' },
  'Mississippi State':{ short: 'Miss State',       emoji: 'üê∂' },
  'Missouri':         { emoji: 'üêØ' },
  'Oklahoma':         { emoji: 'üèπ' },
  'South Carolina':   { short: 'South Car',        emoji: 'üêì' },
  'Tennessee':        { emoji: 'üçä' },
  'Texas A&M':        { emoji: 'üê∂' },
  'Vanderbilt':       { emoji: '‚≠ê' },

  // ‚îÄ‚îÄ Big East ‚îÄ‚îÄ
  'Butler':           { emoji: 'üê∂' },
  'Connecticut':      { display: 'UConn',          short: 'UConn',      emoji: 'üêï' },
  'Creighton':        { emoji: 'üîµ' },
  'DePaul':           { emoji: 'üíô' },
  'Georgetown':       { emoji: 'üê∫' },
  'Marquette':        { emoji: 'ü¶Ö' },
  'Providence':       { emoji: 'üî•' },
  'Seton Hall':       { emoji: 'üîµ' },
  "St. John's":       { emoji: 'üî¥' },
  'Villanova':        { emoji: 'üê±' },
  'Xavier':           { emoji: 'üêâ' },

  // ‚îÄ‚îÄ Atlantic 10 ‚îÄ‚îÄ
  'Dayton':           { emoji: 'üî¥' },
  'Davidson':         { emoji: 'üêæ' },
  'Duquesne':         { emoji: 'ü¶Ö' },
  'Fordham':          { emoji: 'üêè' },
  'George Mason':     { short: 'G. Mason',         emoji: 'üü¢' },
  'George Washington':{ short: 'GW',               emoji: 'üçí' },
  'La Salle':         { emoji: 'üíô' },
  'Loyola Chicago':   { short: 'Loyola Chi',       emoji: '‚öì' },
  'Massachusetts':    { display: 'UMass',           short: 'UMass',      emoji: 'üîµ' },
  'Rhode Island':     { emoji: 'üêè' },
  'Richmond':         { emoji: 'üï∑Ô∏è' },
  'Saint Louis':      { emoji: '‚öúÔ∏è' },
  "Saint Joseph's":   { short: "St. Joe's",        emoji: 'ü¶Ö' },
  'St. Bonaventure':  { short: 'St Bonav',         emoji: 'üü§' },
  'VCU':              { emoji: 'üêè' },

  // ‚îÄ‚îÄ WCC ‚îÄ‚îÄ
  'Gonzaga':          { emoji: 'üê∂' },
  'Loyola Marymount': { short: 'LMU',              emoji: 'ü¶Å' },
  'Pacific':          { emoji: 'üêØ' },
  'Pepperdine':       { emoji: 'üåä' },
  'Portland':         { emoji: 'üåπ' },
  "Saint Mary's":     { short: "St Mary's",        emoji: '‚öì' },
  'San Diego':        { emoji: '‚öì' },
  'San Francisco':    { short: 'USF',              emoji: 'üåâ' },
  'Santa Clara':      { emoji: 'üåπ' },

  // ‚îÄ‚îÄ Mountain West ‚îÄ‚îÄ
  'Air Force':        { emoji: '‚úàÔ∏è' },
  'Boise State':      { emoji: 'üîµ' },
  'Colorado State':   { short: 'Colorado St',      emoji: 'üêè' },
  'Fresno State':     { emoji: 'üêï' },
  'Nevada':           { emoji: '‚ö°' },
  'New Mexico':       { emoji: 'üéà' },
  'San Diego State':  { short: 'SDSU',             emoji: 'ü¶Ö' },
  'UNLV':             { emoji: 'üé≤' },
  'Utah State':       { emoji: 'üê¥' },
  'Wyoming':          { emoji: 'ü§†' },

  // ‚îÄ‚îÄ American Athletic ‚îÄ‚îÄ
  'Charlotte':        { emoji: 'üêâ' },
  'East Carolina':    { short: 'ECU',              emoji: 'üè¥‚Äç‚ò†Ô∏è' },
  'Florida Atlantic': { short: 'FAU',              emoji: 'ü¶â' },
  'Louisiana Tech':   { short: 'LA Tech',          emoji: 'üîµ' },
  'Memphis':          { emoji: 'üé∏' },
  'Middle Tennessee': { short: 'MTSU',             emoji: 'üîµ' },
  'North Texas':      { emoji: 'ü¶Ö' },
  'Rice':             { emoji: 'ü¶â' },
  'South Florida':    { short: 'USF',              emoji: 'üêÇ' },
  'Temple':           { emoji: 'ü¶â' },
  'Tulane':           { emoji: 'üåä' },
  'Tulsa':            { emoji: 'üå™Ô∏è' },
  'UAB':              { emoji: 'üêâ' },
  'UTEP':             { emoji: 'üåµ' },
  'UTSA':             { emoji: 'üê¶' },
  'Western Kentucky': { short: 'WKU',              emoji: 'üî¥' },
  'Wichita State':    { emoji: 'üåæ' },
  'FIU':              { emoji: 'üêæ' },

  // ‚îÄ‚îÄ Missouri Valley ‚îÄ‚îÄ
  'Bradley':          { emoji: 'üêπ' },
  'Drake':            { emoji: 'üê∂' },
  'Evansville':       { emoji: 'üü£' },
  'Illinois State':   { short: 'Illinois St',      emoji: 'üî¥' },
  'Indiana State':    { emoji: 'üå≤' },
  'Missouri State':   { short: 'Missouri St',      emoji: 'üêª' },
  'Murray State':     { emoji: 'üèá' },
  'Northern Iowa':    { emoji: 'üêæ' },
  'Southern Illinois':{ short: 'SIU',              emoji: 'üêæ' },
  'Valparaiso':       { short: 'Valpo',            emoji: 'üè∞' },
  'Belmont':          { emoji: 'üîµ' },

  // ‚îÄ‚îÄ Mid-American ‚îÄ‚îÄ
  'Akron':            { emoji: 'ü¶ò' },
  'Ball State':       { emoji: 'üî¥' },
  'Bowling Green':    { short: 'BGSU',             emoji: 'üü†' },
  'Buffalo':          { emoji: 'ü¶¨' },
  'Central Michigan': { short: 'Central Mich',     emoji: 'üî•' },
  'Eastern Michigan': { short: 'Eastern Mich',     emoji: 'ü¶Ö' },
  'Kent State':       { emoji: 'ü¶Ö' },
  'Miami (OH)':       { short: 'Miami OH',         emoji: 'üî¥' },
  'Northern Illinois':{ short: 'N Illinois',       emoji: 'üî¥' },
  'Ohio':             { emoji: 'üü¢' },
  'Toledo':           { emoji: 'üü°' },
  'Western Michigan': { short: 'Western Mich',     emoji: 'ü§ô' },

  // ‚îÄ‚îÄ Sun Belt ‚îÄ‚îÄ
  'Appalachian State':{ short: 'App State',        emoji: '‚õ∞Ô∏è' },
  'Arkansas State':   { short: 'Ark State',        emoji: 'üê∫' },
  'Coastal Carolina': { short: 'Coastal Car',      emoji: '‚öì' },
  'Georgia State':    { emoji: 'üîµ' },
  'James Madison':    { short: 'JMU',              emoji: 'üü£' },
  'Louisiana':        { emoji: '‚öúÔ∏è' },
  'Louisiana Monroe': { short: 'ULM',              emoji: 'üî¥' },
  'Marshall':         { emoji: 'üî¢' },
  'Old Dominion':     { emoji: 'ü¶Å' },
  'South Alabama':    { emoji: 'ü¶¨' },
  'Texas State':      { emoji: 'üê±' },
  'Troy':             { emoji: 'üê¥' },
  'Arkansas-Little Rock':{ short: 'UALR',          emoji: 'üî¥' },
  'Southern Miss':    { emoji: 'ü¶Ö' },

  // ‚îÄ‚îÄ ASUN ‚îÄ‚îÄ
  'Bellarmine':       { emoji: 'üîµ' },
  'Eastern Kentucky': { short: 'Eastern KY',       emoji: 'ü¶Ö' },
  'Florida Gulf Coast':{ short: 'FGCU',            emoji: 'ü¶Ö' },
  'Jacksonville':     { emoji: 'üê¨' },
  'Kennesaw State':   { short: 'KSU',              emoji: 'ü¶â' },
  'Liberty':          { emoji: 'üî•' },
  'Lipscomb':         { emoji: 'ü¶¨' },
  'North Alabama':    { emoji: 'ü¶Å' },
  'North Florida':    { emoji: 'üêä' },
  'Queens':           { emoji: 'üëë' },
  'Jacksonville State':{ short: 'Jax State',       emoji: 'üêì' },

  // ‚îÄ‚îÄ CAA ‚îÄ‚îÄ
  'Campbell':         { emoji: 'üê™' },
  'Charleston':       { emoji: '‚öì' },
  'Delaware':         { emoji: 'üíô' },
  'Drexel':           { emoji: 'üêâ' },
  'Elon':             { emoji: 'üïäÔ∏è' },
  'Hampton':          { emoji: 'üêæ' },
  'Hofstra':          { emoji: 'ü¶Å' },
  'Monmouth':         { emoji: 'ü¶Ö' },
  'NC A&T':           { emoji: 'üêä' },
  'Northeastern':     { emoji: 'üêæ' },
  'Stony Brook':      { emoji: 'üê∫' },
  'Towson':           { emoji: 'üêØ' },
  'UNC Wilmington':   { short: 'UNCW',             emoji: 'üåä' },
  'William & Mary':   { short: 'W&M',              emoji: 'üëë' },

  // ‚îÄ‚îÄ Patriot ‚îÄ‚îÄ
  'American':         { emoji: 'ü¶Ö' },
  'Army':             { emoji: 'üéñÔ∏è' },
  'Boston University':{ short: 'BU',               emoji: 'üêæ' },
  'Bucknell':         { emoji: 'ü¶¨' },
  'Colgate':          { emoji: 'üü•' },
  'Holy Cross':       { emoji: '‚úùÔ∏è' },
  'Lafayette':        { emoji: 'ü¶Å' },
  'Lehigh':           { emoji: 'üü§' },
  'Loyola Maryland':  { short: 'Loyola MD',        emoji: 'üêï' },
  'Navy':             { emoji: '‚öì' },

  // ‚îÄ‚îÄ Ivy League ‚îÄ‚îÄ
  'Columbia':         { emoji: 'ü¶Å' },
  'Cornell':          { emoji: 'üêª' },
  'Dartmouth':        { emoji: 'üíö' },
  'Harvard':          { emoji: 'üìö' },
  'Penn':             { emoji: 'üî¥' },
  'Princeton':        { emoji: 'üêØ' },
  'Yale':             { emoji: 'üê∂' },

  // ‚îÄ‚îÄ Southern ‚îÄ‚îÄ
  'East Tennessee State':{ short: 'ETSU',          emoji: 'ü¶¨' },
  'Furman':           { emoji: 'üü£' },
  'Mercer':           { emoji: 'üêª' },
  'Samford':          { emoji: 'üê∂' },
  'The Citadel':      { emoji: '‚öîÔ∏è' },
  'VMI':              { emoji: '‚öîÔ∏è' },
  'Western Carolina': { short: 'Western Car',      emoji: 'üê±' },
  'Wofford':          { emoji: 'üêï' },
  'UNC Greensboro':   { emoji: 'üåÄ' },

  // ‚îÄ‚îÄ Horizon ‚îÄ‚îÄ
  'Cleveland State':  { short: 'Cleveland St',     emoji: '‚öîÔ∏è' },
  'Detroit Mercy':    { short: 'Detroit',          emoji: '‚öôÔ∏è' },
  'IUPUI':            { emoji: 'üîµ' },
  'Milwaukee':        { emoji: 'ü¶Ö' },
  'Northern Kentucky':{ short: 'NKU',              emoji: 'üèπ' },
  'Oakland':          { emoji: 'ü¶å' },
  'Purdue Fort Wayne':{ short: 'Purdue FW',        emoji: 'üîµ' },
  'Robert Morris':    { emoji: 'ü¶Ö' },
  'Wright State':     { emoji: 'ü¶Ö' },
  'Youngstown State': { short: 'Youngstown',       emoji: 'üêß' },
  'UIC':              { emoji: 'üîµ' },

  // ‚îÄ‚îÄ MAAC ‚îÄ‚îÄ
  'Canisius':         { emoji: 'ü¶Ö' },
  'Fairfield':        { emoji: 'ü¶å' },
  'Iona':             { emoji: 'üè∞' },
  'Manhattan':        { emoji: 'üóΩ' },
  'Marist':           { emoji: 'ü¶ä' },
  'Niagara':          { emoji: 'üíß' },
  'Quinnipiac':       { emoji: 'üêª' },
  'Rider':            { emoji: 'ü¶Ö' },
  "Saint Peter's":    { short: "St Peter's",       emoji: 'ü¶ö' },
  'Siena':            { emoji: 'üü¢' },

  // ‚îÄ‚îÄ Big Sky ‚îÄ‚îÄ
  'Eastern Washington':{ short: 'E Washington',    emoji: 'ü¶Ö' },
  'Gardner-Webb':     { emoji: 'üîµ' },
  'High Point':       { emoji: 'üîµ' },
  'Idaho':            { emoji: 'ü•î' },
  'Idaho State':      { emoji: 'üêª' },
  'Longwood':         { emoji: 'üå≤' },
  'Montana':          { emoji: '‚õ∞Ô∏è' },
  'Montana State':    { short: 'Montana St',       emoji: 'üê±' },
  'Northern Arizona': { short: 'N Arizona',        emoji: 'üê∫' },
  'Northern Colorado':{ short: 'N Colorado',       emoji: 'üêª' },
  'Portland State':   { short: 'Portland St',      emoji: 'üå≤' },
  'Radford':          { emoji: 'üîµ' },
  'Sacramento State': { short: 'Sac State',        emoji: 'üêù' },
  'Southern Utah':    { emoji: 'ü¶¶' },
  'UNC Asheville':    { emoji: 'üîµ' },
  'Weber State':      { emoji: 'üêù' },
  'Winthrop':         { emoji: 'ü¶Ö' },

  // ‚îÄ‚îÄ Big West ‚îÄ‚îÄ
  'Cal Poly':         { emoji: 'üê¥' },
  'Cal State Bakersfield':{ short: 'CSUB',         emoji: 'üêï' },
  'Cal State Fullerton':{ short: 'CS Fullerton',   emoji: 'üêò' },
  'Cal State Northridge':{ short: 'CSUN',          emoji: 'üèîÔ∏è' },
  'Hawaii':           { short: 'Hawai ªi',          emoji: 'üå∫' },
  'Long Beach State': { short: 'Long Beach',       emoji: 'üåä' },
  'UC Davis':         { emoji: 'üêÑ' },
  'UC Irvine':        { emoji: 'üêú' },
  'UC Riverside':     { emoji: 'üêª' },
  'UC San Diego':     { emoji: 'üåä' },
  'UC Santa Barbara': { short: 'UCSB',             emoji: 'üèÑ' },

  // ‚îÄ‚îÄ WAC ‚îÄ‚îÄ
  'Grand Canyon':     { short: 'GCU',              emoji: 'üèúÔ∏è' },
  'Incarnate Word':   { short: 'UIW',              emoji: '‚öúÔ∏è' },
  'Lamar':            { emoji: 'üî¥' },
  'New Mexico State': { short: 'NMSU',             emoji: 'üåµ' },
  'Sam Houston':      { emoji: 'ü§†' },
  'Seattle':          { emoji: '‚òï' },
  'Stephen F. Austin':{ short: 'SFA',              emoji: 'üå≤' },
  'Tarleton State':   { short: 'Tarleton',         emoji: 'ü§†' },
  'Texas A&M-Corpus Christi':{ short: 'TAMUCC',   emoji: 'üåä' },
  'UT Arlington':     { emoji: 'ü§†' },
  'Utah Tech':        { emoji: 'üåµ' },
  'Utah Valley':      { emoji: 'ü¶Ö' },

  // ‚îÄ‚îÄ Ohio Valley ‚îÄ‚îÄ
  'Eastern Illinois': { short: 'E Illinois',       emoji: 'üêæ' },
  'Morehead State':   { short: 'Morehead St',      emoji: 'ü¶Ö' },
  'SIU Edwardsville': { short: 'SIUe',             emoji: 'üü†' },
  'Southeast Missouri State':{ short: 'SEMO',      emoji: 'üü°' },
  'Southern Indiana': { emoji: 'ü¶Ö' },
  'Tennessee Martin': { short: 'UT Martin',        emoji: 'üåÄ' },
  'Tennessee State':  { short: 'Tenn State',       emoji: 'üêØ' },
  'Tennessee Tech':   { short: 'Tenn Tech',        emoji: 'ü¶Ö' },

  // ‚îÄ‚îÄ Summit ‚îÄ‚îÄ
  'Denver':           { emoji: '‚õ∑Ô∏è' },
  'North Dakota State':{ short: 'NDSU',            emoji: 'ü¶¨' },
  'Omaha':            { emoji: 'üåæ' },
  'Oral Roberts':     { emoji: 'ü¶Ö' },
  'South Dakota State':{ short: 'S Dak St',        emoji: 'üê∞' },
  'St. Thomas':       { short: 'St Thomas',        emoji: 'ü¶Ö' },
  'Western Illinois': { emoji: 'üèπ' },

  // ‚îÄ‚îÄ America East ‚îÄ‚îÄ
  'Albany':           { emoji: 'üê∫' },
  'Bryant':           { emoji: 'üê∂' },
  'Maine':            { emoji: 'ü¶û' },
  'New Hampshire':    { emoji: 'üå≤' },
  'NJIT':             { emoji: 'üîµ' },
  'UMass Lowell':     { emoji: 'üîµ' },
  'UMBC':             { emoji: 'üêï' },
  'Vermont':          { emoji: 'üçÅ' },

  // ‚îÄ‚îÄ NEC ‚îÄ‚îÄ
  'Central Connecticut':{ short: 'Cent Conn',      emoji: 'üîµ' },
  'LIU':              { emoji: 'ü¶Å' },
  'Merrimack':        { emoji: 'üü°' },
  'Sacred Heart':     { emoji: 'ü§ç' },
  'Saint Francis':    { short: 'St Francis',       emoji: 'üü¶' },
  'Wagner':           { emoji: 'ü¶Ö' },

  // ‚îÄ‚îÄ SWAC ‚îÄ‚îÄ
  'Alcorn State':     { short: 'Alcorn St',        emoji: 'üêç' },
  'Arkansas-Pine Bluff':{ short: 'UAPB',           emoji: 'ü¶Å' },
  'Bethune-Cookman':  { short: 'B-Cookman',        emoji: 'üêæ' },
  'Florida A&M':      { short: 'FAMU',             emoji: 'üêç' },
  'Grambling':        { emoji: 'üêØ' },
  'Grambling State':  { short: 'Grambling',        emoji: 'üêØ' },
  'Houston Christian':{ short: 'HCU',              emoji: 'üêù' },
  'Jackson State':    { short: 'Jackson St',       emoji: 'üêØ' },
  'Mississippi Valley State':{ short: 'Miss Valley',emoji: 'üê∂' },
  'Prairie View A&M': { short: 'PV A&M',           emoji: 'üêæ' },
  'Southern':         { emoji: 'üêæ' },
  'Texas Southern':   { emoji: 'üêØ' },

  // ‚îÄ‚îÄ MEAC ‚îÄ‚îÄ
  'Coppin State':     { short: 'Coppin St',        emoji: 'ü¶Ö' },
  'Delaware State':   { short: 'Delaware St',      emoji: 'üêâ' },
  'Howard':           { emoji: 'ü¶¨' },
  'Maryland Eastern Shore':{ short: 'UMES',        emoji: 'ü¶Ö' },
  'Morgan State':     { emoji: 'üêª' },
  'Norfolk State':    { short: 'Norfolk St',       emoji: 'üêØ' },
  'North Carolina Central':{ short: 'NCCU',        emoji: 'ü¶Ö' },
  'South Carolina State':{ short: 'SC State',      emoji: 'üêç' },

  // ‚îÄ‚îÄ Misc ‚îÄ‚îÄ
  'McNeese':          { emoji: 'ü§†' },
  'Nicholls':         { emoji: 'üêä' },
  'Southeastern Louisiana':{ short: 'SE La',       emoji: 'ü¶Ö' },
  'North Carolina A&T':{ short: 'NC A&T',          emoji: 'üêä' },
};

const DEFAULT_EMOJI = 'üèÄ';

// ‚îÄ‚îÄ‚îÄ TEAM LIST ‚Äî built entirely from ESPN's API at boot ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Use var (not let/const) so it's accessible from Chrome devtools console
var TEAM_LIST = [];
var selectedTeams = [];

// Build TEAM_LIST from ESPN's canonical teams endpoint.
// IDs are NEVER hardcoded ‚Äî they come directly from ESPN.
// ESPN conference group IDs for men's college basketball (2025-26 season)
// Fetching by conference gives us accurate conf membership + team IDs in one shot.
const ESPN_CONF_GROUPS = [
  { id: '2',    short: 'ACC',    full: 'Atlantic Coast' },
  { id: '4',    short: 'B10',    full: 'Big Ten' },
  { id: '8',    short: 'SEC',    full: 'Southeastern' },
  { id: '12',   short: 'B12',    full: 'Big 12' },
  { id: '22',   short: 'BE',     full: 'Big East' },
  { id: '3',    short: 'A10',    full: 'Atlantic 10' },
  { id: '26',   short: 'WCC',    full: 'West Coast' },
  { id: '18',   short: 'MW',     full: 'Mountain West' },
  { id: '24',   short: 'MVC',    full: 'Missouri Valley' },
  { id: '14',   short: 'MAC',    full: 'Mid-American' },
  { id: '151',  short: 'AAC',    full: 'American Athletic' },
  { id: '37',   short: 'SBC',    full: 'Sun Belt' },
  { id: '46',   short: 'ASUN',   full: 'Atlantic Sun' },
  { id: '47',   short: 'CAA',    full: 'Colonial Athletic' },
  { id: '48',   short: 'Pat',    full: 'Patriot' },
  { id: '49',   short: 'Ivy',    full: 'Ivy League' },
  { id: '29',   short: 'SoCon',  full: 'Southern' },
  { id: '45',   short: 'HL',     full: 'Horizon' },
  { id: '73',   short: 'MAAC',   full: 'Metro Atlantic Athletic' },
  { id: '40',   short: 'BSky',   full: 'Big Sky' },
  { id: '172',  short: 'BW',     full: 'Big West' },
  { id: '32',   short: 'WAC',    full: 'Western Athletic' },
  { id: '19',   short: 'OVC',    full: 'Ohio Valley' },
  { id: '23',   short: 'Sum',    full: 'Summit' },
  { id: '173',  short: 'AE',     full: 'America East' },
  { id: '2590', short: 'NEC',    full: 'Northeast' },
  { id: '79',   short: 'SWAC',   full: 'Southwestern Athletic' },
  { id: '55',   short: 'MEAC',   full: 'Mid-Eastern Athletic' },
  { id: '60',   short: 'BSouth', full: 'Big South' },
  { id: '62',   short: 'SLC',    full: 'Southland' },
];

async function buildTeamListFromESPN() {
  const seen = new Set();
  const list = [];

  // Step 1: standings gives us teams that have played conf games (most reliable conf assignment)
  await fetchFromStandings(seen, list);
  console.log(`After standings: ${list.length} teams`);

  // Step 2: Use ESPN's path-based groups endpoint ‚Äî /groups/{id}/teams
  // This is different from ?groups= query param and actually scopes to the conference
  await fetchFromGroupsPath(seen, list);
  console.log(`After groups path: ${list.length} teams`);

  // Step 3: Individually fetch any Top 25 teams still missing (non-negotiable)
  if (cachedTop25Ids) {
    const missing = cachedTop25Ids.filter(id => !seen.has(id));
    if (missing.length > 0) {
      console.log(`Fetching ${missing.length} missing Top 25 teams individually...`);
      await Promise.allSettled(missing.map(id => fetchSingleTeam(seen, list, id)));
    }
  }

  list.sort((a, b) => a.display.localeCompare(b.display));
  TEAM_LIST = list;
  window.TEAM_LIST = TEAM_LIST;
  const confCounts = {};
  list.forEach(t => confCounts[t.conf] = (confCounts[t.conf]||0)+1);
  console.log(`‚úÖ TEAM_LIST: ${list.length} teams`, confCounts);
}

async function fetchFromStandings(seen, list) {
  const results = await Promise.allSettled(
    ESPN_CONF_GROUPS.map(conf =>
      fetch(
        `https://site.api.espn.com/apis/v2/sports/basketball/mens-college-basketball/standings?group=${conf.id}&season=2026`,
        { cache: 'no-store' }
      )
      .then(r => r.ok ? r.json() : Promise.reject(`HTTP ${r.status}`))
      .then(data => ({ conf, data }))
    )
  );
  for (const result of results) {
    if (result.status !== 'fulfilled') continue;
    const { conf, data } = result.value;
    const entries = data.standings?.entries
      || data.children?.[0]?.standings?.entries
      || [];
    for (const entry of entries) {
      if (entry.team?.id) addTeam(seen, list, entry.team, conf);
    }
  }
}

async function fetchFromGroupsPath(seen, list) {
  // ESPN's core API has a /groups/{id}/teams endpoint that is genuinely conf-scoped
  const results = await Promise.allSettled(
    ESPN_CONF_GROUPS.map(conf =>
      fetch(
        `https://sports.core.api.espn.com/v2/sports/basketball/leagues/mens-college-basketball/seasons/2026/types/2/groups/${conf.id}/teams?limit=100`,
        { cache: 'no-store' }
      )
      .then(r => r.ok ? r.json() : Promise.reject(`HTTP ${r.status} for ${conf.short}`))
      .then(data => ({ conf, data }))
    )
  );

  for (const result of results) {
    if (result.status !== 'fulfilled') {
      console.warn('groups path failed:', result.reason);
      continue;
    }
    const { conf, data } = result.value;

    // This endpoint returns $ref links: { items: [{ $ref: '.../teams/127' }, ...] }
    const items = data.items || data.teams || [];
    const teamIds = items
      .map(item => {
        if (item.id) return String(item.id);
        if (item.$ref) {
          const m = item.$ref.match(/\/teams\/(\d+)/);
          return m ? m[1] : null;
        }
        return null;
      })
      .filter(Boolean);

    // Fetch any IDs we don't have yet
    const newIds = teamIds.filter(id => !seen.has(id));
    if (newIds.length > 0) {
      await Promise.allSettled(
        newIds.map(id => fetchSingleTeam(seen, list, id, conf))
      );
    }
  }
}

async function fetchSingleTeam(seen, list, id, conf) {
  if (seen.has(String(id))) return;
  try {
    const r = await fetch(
      `https://site.api.espn.com/apis/site/v2/sports/basketball/mens-college-basketball/teams/${id}`,
      { cache: 'no-store' }
    );
    if (!r.ok) return;
    const d = await r.json();
    const t = d.team;
    if (!t) return;

    // If no conf provided, try to infer from team data
    if (!conf) {
      const groupName = t.groups?.parent?.name || t.groups?.name || '';
      conf = ESPN_CONF_GROUPS.find(c =>
        groupName && (
          c.full.toLowerCase().replace(/ /g,'').includes(groupName.toLowerCase().replace(/ /g,'').slice(0,5)) ||
          groupName.toLowerCase().includes(c.full.toLowerCase().split(' ')[0].toLowerCase())
        )
      ) || { short: '‚Äî', full: '', id: '' };
    }
    addTeam(seen, list, t, conf);
  } catch(e) {}
}

function addTeam(seen, list, t, conf) {
  const id = String(t.id);
  if (!id || seen.has(id)) return;
  seen.add(id);
  const keys = [t.location, t.shortDisplayName, t.displayName, t.abbreviation].filter(Boolean);
  let meta = {};
  for (const k of keys) {
    if (TEAM_META[k]) { meta = TEAM_META[k]; break; }
  }
  const display = meta.display || t.shortDisplayName || t.location || t.displayName || id;
  list.push({
    id,
    display,
    short:         meta.short || t.abbreviation || display,
    emoji:         meta.emoji || DEFAULT_EMOJI,
    conf:          conf.short,
    confFull:      conf.full,
    confId:        conf.id,
    vibe:          meta.vibe || 'love',
    aliases:       meta.aliases || [],
    _espnLocation: t.location || '',
  });
}


// Build conference filter categories from live TEAM_LIST
function buildConferenceCategories() {
  const seen = new Map();
  for (const t of TEAM_LIST) {
    if (t.conf && t.conf !== '‚Äî' && !seen.has(t.conf)) seen.set(t.conf, t.conf);
  }
  return Array.from(seen.keys())
    .sort((a, b) => a.localeCompare(b))
    .map(c => ({ id: c, label: c }));
}

// ‚îÄ‚îÄ‚îÄ CELEBRITY PACKS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const CELEB_PACKS = [
  {
    name: 'MJ', fullName: 'Michael Jordan', avatar: 'üêê',
    teams: ['North Carolina', 'Illinois', 'NC State', 'Marquette', 'Georgetown', 'Kansas'],
  },
  {
    name: 'LeBron', fullName: 'LeBron James', avatar: 'üëë',
    // 'UConn' resolves via display override; 'Dook' via alias on Duke's entry
    teams: ['Ohio State', 'Kentucky', 'Akron', 'UCLA', 'Michigan', 'Dook'],
  },
  {
    name: 'Brady', fullName: 'Tom Brady', avatar: 'üèà',
    teams: ['Michigan', 'Michigan State', 'UCLA', 'Notre Dame', 'Stanford', 'UConn'],
  },
  {
    name: 'Obama', fullName: 'Barack Obama', avatar: 'üá∫üá∏',
    teams: ['Illinois', 'Kansas', 'North Carolina', 'Oregon', 'Harvard', 'Michigan State'],
  },
  {
    name: 'Barkley', fullName: 'Charles Barkley', avatar: 'üçë',
    teams: ['Auburn', 'Alabama', 'LSU', 'Gonzaga', 'Kansas', 'Kentucky'],
  },
];

function findTeamByName(name) {
  const lower = name.toLowerCase();
  return TEAM_LIST.find(t =>
    t.display === name ||
    t.display.toLowerCase() === lower ||
    t._espnLocation?.toLowerCase() === lower ||
    t.aliases.includes(lower)
  );
}

function loadCelebPack(pack) {
  const resolved = pack.teams.map(findTeamByName).filter(Boolean).slice(0, 6);
  selectedTeams = resolved;
  saveSaved(selectedTeams);
  renderSelector();
  loadAll();
}

function renderCelebRow() {
  const row = document.getElementById('celeb-row');
  row.innerHTML = CELEB_PACKS.map(pack => `
    <div class="celeb-chip" onclick="loadCelebPack(CELEB_PACKS.find(p=>p.name==='${pack.name}'))"
         title="${pack.fullName}'s picks">
      <span class="celeb-avatar">${pack.avatar}</span>
      <span class="celeb-name">${pack.name}</span>
    </div>`).join('');
}

// ‚îÄ‚îÄ‚îÄ AP RANKINGS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let cachedTop25Ids = null;

async function fetchTop25Ids() {
  if (cachedTop25Ids) return cachedTop25Ids;
  try {
    const r = await fetch(
      'https://site.api.espn.com/apis/site/v2/sports/basketball/mens-college-basketball/rankings',
      { cache: 'no-store' }
    );
    if (!r.ok) throw new Error(`HTTP ${r.status}`);
    const data = await r.json();
    const ap = (data.rankings || []).find(p =>
      p.type === 'ap' || (p.name || '').includes('AP')
    ) || data.rankings?.[0];
    if (!ap?.ranks?.length) throw new Error('No ranks found');
    cachedTop25Ids = ap.ranks
      .sort((a, b) => a.current - b.current)
      .map(rk => String(rk.team?.id))
      .filter(Boolean);
    return cachedTop25Ids;
  } catch(e) {
    console.warn('Rankings fetch failed:', e);
    return null;
  }
}

// ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// v3 key ‚Äî avoids loading corrupt old hardcoded-ID data
const STORAGE_KEY = 'dww_selected_teams_v3';

function loadSavedNames() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : [];
  } catch { return []; }
}

function resolveFromSaved(names) {
  return names.map(name => TEAM_LIST.find(t => t.display === name)).filter(Boolean);
}

function saveSaved(teams) {
  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(teams.map(t => t.display))); } catch {}
}

// selectedTeams declared above as var

// ‚îÄ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const fmtTime = d => new Date(d).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', timeZone: 'America/New_York' }) + ' ET';
const fmtDateShort = d => new Date(d).toLocaleDateString('en-US', { month: 'short', day: 'numeric', timeZone: 'America/New_York' });

function smartDate(dateStr) {
  const now   = new Date();
  const game  = new Date(dateStr);
  const etNow  = new Date(now.toLocaleString('en-US',  { timeZone: 'America/New_York' }));
  const etGame = new Date(game.toLocaleString('en-US', { timeZone: 'America/New_York' }));
  const diffDays = Math.round((new Date(etGame).setHours(0,0,0,0) - new Date(etNow).setHours(0,0,0,0)) / 86400000);
  const gameHour = new Date(game.toLocaleString('en-US', { timeZone: 'America/New_York' })).getHours();
  const eve = gameHour >= 19;
  if (diffDays === 0)  return eve ? 'Tonight' : 'Today';
  if (diffDays === 1)  return eve ? 'Tomorrow night' : 'Tomorrow';
  if (diffDays === -1) return eve ? 'Last night' : 'Yesterday';
  if (diffDays === 2)  return 'In 2 days';
  return fmtDateShort(dateStr);
}

function teamMatches(c, teamId) {
  return c.team?.id === teamId || c.team?.id === String(teamId) ||
         c.id === teamId || c.id === String(teamId);
}
function getMe(comp, teamId)  { return comp.competitors?.find(c => teamMatches(c, teamId)); }
function getOpp(comp, teamId) { return comp.competitors?.find(c => !teamMatches(c, teamId)); }

function extractScore(c) {
  if (!c) return '?';
  const s = c.score;
  if (s == null) return '?';
  if (typeof s === 'object') return s.displayValue ?? s.value ?? '?';
  return s;
}

function periodLabel(comp) {
  const s = comp.status;
  if (!s) return '';
  const p = s.period || 0;
  const half = p === 1 ? '1st Half' : p === 2 ? '2nd Half' : 'OT';
  const clock = s.displayClock;
  return (clock && clock !== '0:00') ? `${half} ¬∑ ${clock}` : half;
}

// ‚îÄ‚îÄ‚îÄ FETCH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function fetchTeam(team) {
  const [schedRes, summaryRes] = await Promise.all([
    fetch(`https://site.api.espn.com/apis/site/v2/sports/basketball/mens-college-basketball/teams/${team.id}/schedule`, { cache: 'no-store' }),
    fetch(`https://site.api.espn.com/apis/site/v2/sports/basketball/mens-college-basketball/teams/${team.id}`, { cache: 'no-store' }),
  ]);
  if (!schedRes.ok) throw new Error(`HTTP ${schedRes.status}`);
  const data        = await schedRes.json();
  const summaryData = summaryRes.ok ? await summaryRes.json() : null;

  const events = (data.events || []).sort((a, b) => new Date(a.date) - new Date(b.date));

  let lastCompleted = null, liveGame = null, nextGame = null;
  const allGames = [];

  for (const ev of events) {
    const comp = ev.competitions?.[0];
    if (!comp) continue;
    const state = comp.status?.type?.state;
    allGames.push({ ev, comp, state });
    if      (state === 'post')               lastCompleted = { ev, comp };
    else if (state === 'in')                 liveGame      = { ev, comp };
    else if (state === 'pre' && !nextGame)   nextGame      = { ev, comp };
  }

  const teamInfo  = summaryData?.team || data.team || {};
  const recItems  = teamInfo?.record?.items || data.team?.record?.items || [];
  const totalRec  = recItems.find(r => r.type === 'total') || recItems[0];
  const recordStr = totalRec?.summary || '';

  let confRecordStr = '';
  try {
    if (team.confId) {
      const confRes = await fetch(
        `https://sports.core.api.espn.com/v2/sports/basketball/leagues/mens-college-basketball/seasons/2026/types/2/groups/${team.confId}/teams/${team.id}/records/9`,
        { cache: 'no-store' }
      );
      if (confRes.ok) {
        const confData = await confRes.json();
        confRecordStr = confData.summary || confData.displayValue || '';
      }
    }
  } catch(e) {
    confRecordStr = data.team?.standingSummary || '';
  }

  let apRank = null;
  const top25 = cachedTop25Ids || [];
  const rankIdx = top25.indexOf(String(team.id));
  if (rankIdx !== -1) apRank = rankIdx + 1;

  if (liveGame) {
    try {
      const liveRes = await fetch(
        `https://site.api.espn.com/apis/site/v2/sports/basketball/mens-college-basketball/summary?event=${liveGame.ev.id}`,
        { cache: 'no-store' }
      );
      if (liveRes.ok) {
        const liveData = await liveRes.json();
        const liveComp = liveData.header?.competitions?.[0];
        if (liveComp) liveGame.comp = liveComp;
      }
    } catch(e) {}
  }

  return { team, lastCompleted, liveGame, nextGame, allGames, recordStr, confRecordStr, apRank };
}

function getOppRank(comp, teamId) {
  const opp = getOpp(comp, teamId);
  if (!opp) return null;
  const oppId = String(opp.team?.id || opp.id || '');
  if (!oppId || !cachedTop25Ids) return null;
  const idx = cachedTop25Ids.indexOf(oppId);
  return idx !== -1 ? idx + 1 : null;
}

// ‚îÄ‚îÄ‚îÄ CARD THEMES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const LOVE_THEMES = [
  { bg: 'linear-gradient(145deg, #1a3a6b 0%, #2355a0 55%, #3470c8 100%)', shadow: 'rgba(35,85,160,0.4)' },
  { bg: 'linear-gradient(145deg, #1a5c2e 0%, #237a3d 55%, #2e9e50 100%)', shadow: 'rgba(35,122,61,0.4)' },
  { bg: 'linear-gradient(145deg, #6b1a1a 0%, #a02323 55%, #c83434 100%)', shadow: 'rgba(160,35,35,0.4)' },
  { bg: 'linear-gradient(145deg, #4a1a6b 0%, #6c23a0 55%, #8a34c8 100%)', shadow: 'rgba(108,35,160,0.4)' },
  { bg: 'linear-gradient(145deg, #1a4a5c 0%, #237a8e 55%, #2e9eb8 100%)', shadow: 'rgba(35,122,142,0.4)' },
  { bg: 'linear-gradient(145deg, #5c3d1a 0%, #8e6123 55%, #b87c2e 100%)', shadow: 'rgba(142,97,35,0.4)' },
];

function getCardTheme(team, idx) {
  if (team.vibe === 'hate') return { cls: 'hate-card', style: '' };
  const theme = LOVE_THEMES[idx % LOVE_THEMES.length];
  return { cls: 'love-card', style: `--card-bg:${theme.bg};--card-shadow:${theme.shadow};` };
}

// ‚îÄ‚îÄ‚îÄ RENDER FRONT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderFront({ team, lastCompleted, liveGame, nextGame, recordStr, confRecordStr, apRank }) {
  const tid = team.id;
  const isDook = team.display === 'Dook';
  const isHate = team.vibe === 'hate';

  let answerHTML = '', liveDetailsHTML = '';

  if (liveGame) {
    const me  = getMe(liveGame.comp, tid);
    const opp = getOpp(liveGame.comp, tid);
    const myS  = extractScore(me), oppS = extractScore(opp);
    const oppName = opp?.team?.shortDisplayName || opp?.team?.displayName || 'Opp';
    const oppRank = getOppRank(liveGame.comp, tid);
    const atStr  = me?.homeAway === 'home' ? 'vs' : '@';
    const rankBit = oppRank ? ` <span class="opp-rank">#${oppRank}</span>` : '';
    const myScoreN = parseInt(myS) || 0, oppScoreN = parseInt(oppS) || 0;
    const winBit = (myScoreN > 0 || oppScoreN > 0)
      ? (myScoreN > oppScoreN ? ' <span class="winning-tag">‚ñ≤ Winning</span>'
       : myScoreN < oppScoreN ? ' <span class="winning-tag losing">‚ñº Losing</span>'
       : ' <span class="winning-tag tied">Tied</span>') : '';
    answerHTML      = `<div class="answer live">LIVE</div>`;
    liveDetailsHTML = `
      <div class="live-details">${myS} ‚Äì ${oppS} ¬∑ ${periodLabel(liveGame.comp)}${winBit}</div>
      <div class="live-opponent">${atStr}${rankBit} <strong>${oppName}</strong></div>`;
  } else if (lastCompleted) {
    const me  = getMe(lastCompleted.comp, tid);
    const won = me?.winner === true;
    const yesEmoji = isDook ? 'ü§¢' : isHate ? 'üòí' : 'üéâ';
    const noEmoji  = isDook ? 'üéâüéäüôå' : isHate ? 'üòÇ' : 'üò¨';
    answerHTML = `<div class="answer ${won ? 'yes' : 'no'}">${won ? 'YES ' + yesEmoji : 'NO ' + noEmoji}</div>`;
  } else {
    answerHTML = `<div class="answer tbd">‚Äî</div>`;
  }

  const rankHTML = apRank ? `<span class="rank-badge">#${apRank} AP</span>` : '';
  const recParts = [];
  if (recordStr)     recParts.push(`<span class="rec-item">${recordStr} overall</span>`);
  if (confRecordStr) recParts.push(`<span class="rec-item conf">${confRecordStr}</span>`);
  const statsHTML = (rankHTML || recParts.length) ? `<div class="stats-row">${rankHTML}${recParts.join('')}</div>` : '';

  let lastGameHTML = '';
  if (lastCompleted) {
    const { ev, comp } = lastCompleted;
    const me  = getMe(comp, tid), opp = getOpp(comp, tid);
    const won = me?.winner === true;
    const myS = extractScore(me), oppS = extractScore(opp);
    const oppName = opp?.team?.shortDisplayName || opp?.team?.displayName || 'Opp';
    const oppRank = getOppRank(comp, tid);
    const atStr = me?.homeAway === 'home' ? 'vs' : '@';
    const when  = smartDate(ev.date);
    lastGameHTML = `
      <div class="front-game">
        <div class="front-game-label">Last game</div>
        <div class="front-game-line">
          ${when} ¬∑ ${atStr}${oppRank ? ` <span class="opp-rank">#${oppRank}</span>` : ''} <strong>${oppName}</strong>
          <span class="front-badge ${won ? 'w' : 'l'}">${won ? 'W' : 'L'} ${myS}‚Äì${oppS}</span>
        </div>
      </div>`;
  }

  let nextGameHTML = '';
  if (nextGame) {
    const { ev, comp } = nextGame;
    const me  = getMe(comp, tid), opp = getOpp(comp, tid);
    const oppName = opp?.team?.shortDisplayName || opp?.team?.displayName || 'Opp';
    const oppRank = getOppRank(comp, tid);
    const atStr = me?.homeAway === 'home' ? 'vs' : '@';
    const when  = smartDate(ev.date);
    const time  = fmtTime(ev.date);
    nextGameHTML = `
      <div class="front-game">
        <div class="front-game-label">Next game</div>
        <div class="front-game-line">
          ${when} ¬∑ ${atStr}${oppRank ? ` <span class="opp-rank">#${oppRank}</span>` : ''} <strong>${oppName}</strong>
          <span class="front-badge up">${time}</span>
        </div>
      </div>`;
  }

  const tagText = isDook ? 'ü§Æ absolute garbage' : isHate ? 'üóëÔ∏è boo' : null;
  const tagClass = isHate ? 'hate-tag' : 'love-tag';

  return `
    <div class="team-header">
      <span class="team-emoji">${team.emoji}</span>
      <div class="team-name-row"><span class="team-name">${team.display}</span></div>
      ${tagText ? `<div class="team-tag-row"><span class="${tagClass}">${tagText}</span></div>` : ''}
      <div class="team-sub">${team.conf} ¬∑ ${team.short}</div>
    </div>
    ${answerHTML}
    ${liveDetailsHTML}
    ${statsHTML}
    ${lastGameHTML}
    ${nextGameHTML}
    <div class="hint"><span class="hint-hover">hover</span><span class="hint-tap">tap</span> for schedule ‚Üó</div>
  `;
}

// ‚îÄ‚îÄ‚îÄ RENDER BACK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderBack({ team, allGames, liveGame, apRank, recordStr, confRecordStr }) {
  const tid = team.id;
  const completed = allGames.filter(g => g.state === 'post').slice(-5);
  const live      = allGames.filter(g => g.state === 'in');
  const upcoming  = allGames.filter(g => g.state === 'pre').slice(0, 5);

  const completedRows = completed.map(({ ev, comp }) => {
    const me  = getMe(comp, tid), opp = getOpp(comp, tid);
    const oppName = opp?.team?.shortDisplayName || opp?.team?.displayName || 'Opp';
    const oppRank = getOppRank(comp, tid);
    const atStr = me?.homeAway === 'home' ? 'vs' : '@';
    const won   = me?.winner === true;
    const myS = extractScore(me), oppS = extractScore(opp);
    const when  = smartDate(ev.date);
    const rStr  = oppRank ? `<span class="sched-opp-rank">#${oppRank}</span> ` : '';
    return `<div class="sched-row">
      <span class="sched-date">${when}</span>
      <span class="sched-opp">${atStr} ${rStr}${oppName}</span>
      <span class="sched-result ${won ? 'w' : 'l'}">${won ? 'W' : 'L'} ${myS}‚Äì${oppS}</span>
    </div>`;
  }).join('');

  const liveRows = live.map(({ ev, comp: rawComp }) => {
    const comp = (liveGame && liveGame.ev.id === ev.id) ? liveGame.comp : rawComp;
    const me  = getMe(comp, tid), opp = getOpp(comp, tid);
    const oppName = opp?.team?.shortDisplayName || opp?.team?.displayName || 'Opp';
    const oppRank = getOppRank(comp, tid);
    const atStr = me?.homeAway === 'home' ? 'vs' : '@';
    const myS = extractScore(me), oppS = extractScore(opp);
    const rStr  = oppRank ? `<span class="sched-opp-rank">#${oppRank}</span> ` : '';
    return `<div class="sched-row current">
      <span class="sched-date">Now</span>
      <span class="sched-opp">${atStr} ${rStr}${oppName}</span>
      <span class="sched-result live">LIVE ${myS}‚Äì${oppS} ¬∑ ${periodLabel(comp)}</span>
    </div>`;
  }).join('');

  const upcomingRows = upcoming.map(({ ev, comp }, i) => {
    const me  = getMe(comp, tid), opp = getOpp(comp, tid);
    const oppName = opp?.team?.shortDisplayName || opp?.team?.displayName || 'Opp';
    const oppRank = getOppRank(comp, tid);
    const atStr  = me?.homeAway === 'home' ? 'vs' : '@';
    const isNext = i === 0 && !live.length;
    const when   = smartDate(ev.date);
    const time   = fmtTime(ev.date);
    const rStr   = oppRank ? `<span class="sched-opp-rank">#${oppRank}</span> ` : '';
    return `<div class="sched-row ${isNext ? 'current' : ''}">
      <span class="sched-date">${when}</span>
      <span class="sched-opp">${atStr} ${rStr}${oppName}</span>
      <span class="sched-result upcoming">${time}</span>
    </div>`;
  }).join('');

  const rankStr = apRank ? `<span class="back-rank">#${apRank} AP</span>` : '';
  const recStr  = recordStr ? `<span class="back-rec">${recordStr}</span>` : '';
  const confStr = confRecordStr ? `<span class="back-rec conf">${confRecordStr}</span>` : '';

  return `
    <div class="back-header">
      <span class="back-title">${team.emoji} Schedule</span>
      <span class="back-meta">${rankStr}${recStr}${confStr}</span>
    </div>
    <div class="schedule-list">
      ${completedRows}
      ${(liveRows || upcomingRows) ? '<div class="divider"></div>' : ''}
      ${liveRows}
      ${upcomingRows}
    </div>
  `;
}

// ‚îÄ‚îÄ‚îÄ CARD SHELL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderCard(result, idx) {
  const { cls, style } = getCardTheme(result.team, idx);
  return `
    <div class="card ${cls}" style="${style}${cls==='love-card'?`background:var(--card-bg);box-shadow:0 8px 40px var(--card-shadow),0 0 0 1px rgba(255,255,255,0.06);`:''}" onclick="this.classList.toggle('flipped')">
      <div class="card-front">${renderFront(result)}</div>
      <div class="card-back">${renderBack(result)}</div>
    </div>`;
}

function renderError(team, idx) {
  const { cls, style } = getCardTheme(team, idx);
  return `
    <div class="card ${cls}" style="${style}${cls==='love-card'?`background:var(--card-bg);`:'' }">
      <div class="card-front">
        <div><span class="team-emoji">${team.emoji}</span><span class="team-name">${team.display}</span></div>
        <div class="answer tbd">‚Äî</div>
        <div style="color:rgba(255,255,255,0.2);font-size:0.72rem;font-style:italic">Couldn't load ¬∑ will retry</div>
      </div>
      <div class="card-back"><div class="back-title">No data</div></div>
    </div>`;
}

// ‚îÄ‚îÄ‚îÄ MAIN LOAD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadAll() {
  const grid = document.getElementById('grid');
  if (!selectedTeams.length) {
    grid.innerHTML = `<div class="empty-state"><div class="empty-icon">üèÄ</div><p>Select your favorite teams below to get started</p></div>`;
    return;
  }

  if (!grid.children.length || grid.querySelector('.empty-state')) {
    grid.innerHTML = selectedTeams.map((t, i) => {
      const { cls, style } = getCardTheme(t, i);
      return `<div class="card loading ${cls}" style="${style}${cls==='love-card'?`background:var(--card-bg);`:''}" >
        <div class="card-front">
          <div><span class="team-emoji">${t.emoji}</span><span class="team-name">${t.display}</span></div>
          <div class="answer tbd" style="margin-top:auto">‚Ä¶</div>
        </div>
        <div class="card-back"></div>
      </div>`;
    }).join('');
  }

  const results = await Promise.allSettled(selectedTeams.map(fetchTeam));

  grid.innerHTML = results.map((r, i) =>
    r.status === 'fulfilled' ? renderCard(r.value, i) : renderError(selectedTeams[i], i)
  ).join('');

  document.getElementById('last-updated').textContent =
    new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', second: '2-digit' });
}

function manualRefresh() {
  const btn = document.getElementById('refresh-btn');
  btn.classList.add('spinning'); btn.disabled = true;
  loadAll().finally(() => { btn.classList.remove('spinning'); btn.disabled = false; });
}

// ‚îÄ‚îÄ‚îÄ CATEGORY / TOP 25 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function getCategoryTeams(catId) {
  if (catId === 'top25') {
    const ids = await fetchTop25Ids();
    if (!ids || !ids.length) return null;
    return ids.map(id => TEAM_LIST.find(t => t.id === id)).filter(Boolean);
  }
  return TEAM_LIST.filter(t => t.conf === catId);
}

let activeCategory = null;

// ‚îÄ‚îÄ‚îÄ SELECTOR UI ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let searchQuery = '';
let dragSrcIdx  = null;

function isSelected(team) { return selectedTeams.some(t => t.display === team.display); }

function toggleTeam(team) {
  if (isSelected(team)) {
    selectedTeams = selectedTeams.filter(t => t.display !== team.display);
  } else if (selectedTeams.length < 6) {
    selectedTeams = [...selectedTeams, team];
  }
  window.selectedTeams = selectedTeams;
  saveSaved(selectedTeams);
  renderSelector();
  loadAll();
}

function removeTeam(display) {
  selectedTeams = selectedTeams.filter(t => t.display !== display);
  saveSaved(selectedTeams);
  renderSelector();
  loadAll();
}

function clearAllTeams() {
  selectedTeams = [];
  saveSaved(selectedTeams);
  renderSelector();
  loadAll();
}

function renderChips() {
  const container = document.getElementById('selected-chips');
  const clearBtn  = document.getElementById('clear-all-btn');
  if (!selectedTeams.length) {
    container.innerHTML = '<span style="color:rgba(255,255,255,0.15);font-size:0.75rem;">No teams selected yet</span>';
    clearBtn.style.display = 'none';
    return;
  }
  clearBtn.style.display = 'inline-block';
  container.innerHTML = selectedTeams.map((t, i) => `
    <div class="chip" draggable="true" data-idx="${i}"
         ondragstart="dragStart(event,${i})"
         ondragover="dragOver(event,${i})"
         ondrop="dropOn(event,${i})"
         ondragend="dragEnd(event)">
      <span class="chip-drag-handle">‚†ø</span>
      <span class="chip-emoji">${t.emoji}</span>
      <span class="chip-name">${t.short || t.display}</span>
      <span class="chip-remove" onclick="removeTeam('${t.display.replace(/'/g,"\\'")}')">‚úï</span>
    </div>`).join('');
}

async function renderBrowser() {
  const container = document.getElementById('team-browser');
  const q = searchQuery.toLowerCase().trim();

  let filtered;
  if (q) {
    filtered = TEAM_LIST.filter(t =>
      t.display.toLowerCase().includes(q) ||
      t.conf.toLowerCase().includes(q) ||
      t._espnLocation?.toLowerCase().includes(q) ||
      t.aliases.some(a => a.includes(q))
    );
  } else if (activeCategory) {
    container.innerHTML = '<div class="no-results" style="color:rgba(255,255,255,0.15)">Loading‚Ä¶</div>';
    filtered = await getCategoryTeams(activeCategory);
    if (filtered === null) {
      container.innerHTML = '<div class="no-results">Couldn\'t load rankings ‚Äî try again in a moment</div>';
      return;
    }
  } else {
    filtered = TEAM_LIST;
  }

  const maxReached = selectedTeams.length >= 6;

  if (!filtered || !filtered.length) {
    container.innerHTML = '<div class="no-results">No teams found</div>';
    return;
  }

  container.innerHTML = filtered.map(t => {
    const sel = isSelected(t);
    const dis = maxReached && !sel;
    const hateClass = t.vibe === 'hate' ? 'hate-option' : '';
    return `<div class="team-option ${sel ? 'selected' : ''} ${dis ? 'disabled' : ''} ${hateClass}"
                 onclick="toggleTeam(TEAM_LIST.find(x=>x.display==='${t.display.replace(/'/g,"\\'")}'))">
      <div class="option-check">${sel ? '‚úì' : ''}</div>
      <span class="option-emoji">${t.emoji}</span>
      <div class="option-info">
        <div class="option-name">${t.display}</div>
        <div class="option-conf">${t.conf}</div>
      </div>
    </div>`;
  }).join('');
}

function renderCategories() {
  const row   = document.getElementById('category-row');
  const label = document.getElementById('cat-active-label');
  const confCats = buildConferenceCategories();
  const allCats  = [{ id: 'top25', label: 'üèÜ Top 25' }, ...confCats];

  row.innerHTML = allCats.map(c => {
    const isActive = activeCategory === c.id;
    return `<span class="cat-pill ${isActive ? 'active' : ''}" onclick="selectCategory('${c.id}')">${c.label}</span>`;
  }).join('') + (activeCategory ? `<span class="cat-clear" onclick="clearCategory()">‚úï Clear</span>` : '');

  if (activeCategory) {
    const cat = allCats.find(c => c.id === activeCategory);
    label.textContent = `Filtering by: ${cat?.label || activeCategory}`;
    label.classList.add('visible');
  } else {
    label.classList.remove('visible');
  }
}

async function selectCategory(id) {
  activeCategory = activeCategory === id ? null : id;
  searchQuery = '';
  document.getElementById('team-search').value = '';
  renderCategories();
  await renderBrowser();
}

function clearCategory() {
  activeCategory = null;
  renderCategories();
  renderBrowser();
}

async function renderSelector() {
  renderChips();
  renderCelebRow();
  renderCategories();
  await renderBrowser();
  document.getElementById('sel-count').textContent =
    `${selectedTeams.length} / 6 selected ¬∑ drag chips to reorder`;
}

document.getElementById('team-search').addEventListener('input', async e => {
  searchQuery = e.target.value;
  if (searchQuery) activeCategory = null;
  await renderBrowser();
  renderCategories();
});

// Drag to reorder
function dragStart(e, idx) {
  dragSrcIdx = idx;
  e.currentTarget.classList.add('dragging');
  e.dataTransfer.effectAllowed = 'move';
}
function dragOver(e, idx) {
  e.preventDefault();
  e.dataTransfer.dropEffect = 'move';
  document.querySelectorAll('.chip').forEach(c => c.classList.remove('drag-over'));
  if (idx !== dragSrcIdx) e.currentTarget.classList.add('drag-over');
}
function dropOn(e, toIdx) {
  e.preventDefault();
  if (dragSrcIdx === null || dragSrcIdx === toIdx) return;
  const moved = selectedTeams.splice(dragSrcIdx, 1)[0];
  selectedTeams.splice(toIdx, 0, moved);
  dragSrcIdx = null;
  saveSaved(selectedTeams);
  renderSelector();
  loadAll();
}
function dragEnd(e) {
  dragSrcIdx = null;
  document.querySelectorAll('.chip').forEach(c => {
    c.classList.remove('dragging');
    c.classList.remove('drag-over');
  });
}

// ‚îÄ‚îÄ‚îÄ DEBUG HELPER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Run debugDWW() in the browser console to inspect state
window.debugDWW = function() {
  const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
  console.group('üèÄ Did We Win ‚Äî Debug');
  console.log('TEAM_LIST length:', TEAM_LIST.length);
  console.log('TEAM_LIST sample:', TEAM_LIST.slice(0, 3).map(t => ({display: t.display, id: t.id, conf: t.conf, confId: t.confId})));
  console.log('Saved names:', saved);
  console.log('Selected teams:', selectedTeams.map(t => ({display: t.display, id: t.id, conf: t.conf, confId: t.confId})));
  console.log('Top 25 IDs:', cachedTop25Ids);
  console.groupEnd();

  // Test conf record fetch for first selected team
  const t = selectedTeams[0];
  if (t) {
    const url = `https://sports.core.api.espn.com/v2/sports/basketball/leagues/mens-college-basketball/seasons/2026/types/2/groups/${t.confId}/teams/${t.id}/records/9`;
    console.log(`\nConf record URL for ${t.display}:\n${url}`);
    fetch(url)
      .then(r => { console.log('Status:', r.status); return r.json(); })
      .then(d => console.log('Conf record response:', d))
      .catch(e => console.error('Conf record error:', e));
  }
};

// ‚îÄ‚îÄ‚îÄ BOOT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// 1) Fetch ESPN's full team list (real IDs) + AP poll in parallel
// 2) Resolve any previously saved team names against the fresh TEAM_LIST
// 3) Render UI, start 60s refresh loop
(async () => {
  const savedNames = loadSavedNames();
  await Promise.all([buildTeamListFromESPN(), fetchTop25Ids()]);
  selectedTeams = resolveFromSaved(savedNames);
  window.selectedTeams = selectedTeams;
  await renderSelector();
  await loadAll();
  setInterval(loadAll, 60_000);
})();
</script>
</body>
</html>
